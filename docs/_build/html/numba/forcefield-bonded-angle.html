<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Angle bending &mdash; PYGAMD v1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dihedral torsion" href="forcefield-bonded-dihedral.html" />
    <link rel="prev" title="Bond interactions" href="forcefield-bonded-bond.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> PYGAMD
          </a>
              <div class="version">
                v1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules (NUMBA)</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="system.html">System info</a></li>
<li class="toctree-l1"><a class="reference internal" href="application.html">Application</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="forcefield.html">Force field</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="forcefield-nonbonded.html">Non-bonded interactions</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="forcefield-bonded.html">Bonded interactions</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="forcefield-bonded-bond.html">Bond interactions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Angle bending</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#angle-functions">Angle functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#self-defined-bond-functions">Self-defined bond functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="forcefield-bonded-dihedral.html">Dihedral torsion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules (CUDA)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-system.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-forcefield.html">Force field</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-integration.html">Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-constraint.html">Constraint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cuda/cu-module.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Plug-Ins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../molgen.html">molgen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataTackle.html">dataTackle</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Announcement</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PYGAMD</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="forcefield.html">Force field</a> &raquo;</li>
          <li><a href="forcefield-bonded.html">Bonded interactions</a> &raquo;</li>
      <li>Angle bending</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/numba/forcefield-bonded-angle.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="angle-bending">
<h1>Angle bending<a class="headerlink" href="#angle-bending" title="Permalink to this headline"></a></h1>
<p><strong>Overview</strong></p>
<p>Angles impose forces on specific triplets of particles to model chemical angles between two bonds.
The angles are specified in <a class="reference internal" href="system-data-format.html#mst-format"><span class="std std-ref">MST format</span></a> configuration file with the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">angle</span>
<span class="n">angle_type</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>  <span class="n">particle_i</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="n">particle_j</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="n">particle_k</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>By themselves, angles do nothing. Only when an angle force object is instantiated(i.e. <a class="reference internal" href="#force.angle" title="force.angle"><code class="xref py py-class docutils literal notranslate"><span class="pre">force.angle</span></code></a>), are angle forces actually calculated.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#angle-function"><span class="std std-ref">Angle functions</span></a></p></td>
<td><p><a class="reference internal" href="#force.angle" title="force.angle"><code class="xref py py-class docutils literal notranslate"><span class="pre">force.angle</span></code></a></p></td>
</tr>
</tbody>
</table>
<a class="reference internal image-reference" href="../_images/angle1.png"><img alt="Principle of angle bending" class="align-center" src="../_images/angle1.png" style="width: 250px;" /></a>
<section id="angle-functions">
<span id="angle-function"></span><h2>Angle functions<a class="headerlink" href="#angle-functions" title="Permalink to this headline"></a></h2>
<p>Description:</p>
<blockquote>
<div><p>Function of angle interactions could be either the one called from angle interaction function libary, or the one defined by user himself.
Angle interaction function libary contains harmonic function named as ‘harmonic’ and harmonic cosine function named as ‘harmonic_cos’.</p>
<dl>
<dt>Harmonic function (harmonic)</dt><dd><div class="math notranslate nohighlight">
\begin{eqnarray*}
V_{\mathrm{angle}}(\theta) = \frac{1}{2}k\left( \theta -\theta_{0} \right)^{2}
\end{eqnarray*}</div><p>Coefficients:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(k\)</span> - potential constant <code class="docutils literal notranslate"><span class="pre">k</span></code> (in units of energy/radians^2)</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta_{0}\)</span> - equilibrium angle <code class="docutils literal notranslate"><span class="pre">theta0</span></code> (in radians)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Angles for the functions in library should be given in script in the unit of degree, and the program will convert them into radian automatically.</p>
</div>
</dd>
<dt>Harmonic cosine function (harmonic_cos)</dt><dd><div class="math notranslate nohighlight">
\begin{eqnarray*}
V_{\mathrm{angle}}(\theta)=k\left[ 1-\cos \left( \theta - {\theta}_{0} \right) \right]
\end{eqnarray*}</div><p>Coefficients:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(k\)</span> - potential constant <code class="docutils literal notranslate"><span class="pre">k</span></code> (in units of energy)</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta_{0}\)</span> - equilibrium angle <code class="docutils literal notranslate"><span class="pre">theta0</span></code> (in radians)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Angles for the functions in library should be given in script in the unit of degree, and the program will convert them into radian automatically.</p>
</div>
</dd>
</dl>
</div></blockquote>
<dl class="py class">
<dt class="sig sig-object py" id="force.angle">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">force.</span></span><span class="sig-name descname"><span class="pre">angle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">info</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">func</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#force.angle" title="Permalink to this definition"></a></dt>
<dd><p>Constructor of an angle interaction object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>info</strong> – system information.</p></li>
<li><p><strong>func</strong> – function that is either a string or a device function.</p></li>
</ul>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="force.angle.setParams">
<span class="sig-name descname"><span class="pre">setParams</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">angle_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#force.angle.setParams" title="Permalink to this definition"></a></dt>
<dd><p>specifies the angle interaction parameters with angle type and a list of parameters.</p>
</dd></dl>

<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fa</span> <span class="o">=</span> <span class="n">pygamd</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">mst</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="s1">&#39;harmonic&#39;</span><span class="p">)</span>
<span class="n">fa</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="n">angle_type</span><span class="o">=</span><span class="s1">&#39;a-a-a&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="self-defined-bond-functions">
<h2>Self-defined bond functions<a class="headerlink" href="#self-defined-bond-functions" title="Permalink to this headline"></a></h2>
<p>Description:</p>
<blockquote>
<div><p>The device function for angle interactions could be written in script and conveyed
to kernel funciton for calculation.</p>
<p>With the potential form of angle interactions <span class="math notranslate nohighlight">\(p(\theta)\)</span>, the expression of parameters in script are:</p>
<ul class="simple">
<li><p>p = <span class="math notranslate nohighlight">\(p(\theta)\)</span></p></li>
<li><p>f = <span class="math notranslate nohighlight">\(\partial p(\theta)/\partial \theta\)</span></p></li>
</ul>
<p>Function code template:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@cuda</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">cos_abc</span><span class="p">,</span> <span class="n">sin_abc</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">...</span>
        <span class="n">calculation</span> <span class="n">codes</span>
        <span class="o">...</span>
        <span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">f</span>
        <span class="n">fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>

<span class="n">fa</span> <span class="o">=</span> <span class="n">pygamd</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<span class="n">fa</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="n">bond_type</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
<span class="n">app</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">cuda</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>

<span class="nd">@cuda</span><span class="o">.</span><span class="n">jit</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">harmonic</span><span class="p">(</span><span class="n">cos_abc</span><span class="p">,</span> <span class="n">sin_abc</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dth</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">cos_abc</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t0</span><span class="o">/</span><span class="mf">180.0</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dth</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">nb</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">dth</span>
        <span class="n">fp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">f</span>
        <span class="n">fp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">p</span>

<span class="n">fa</span> <span class="o">=</span> <span class="n">pygamd</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">mst</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">harmonic</span><span class="p">)</span>
<span class="n">fa</span><span class="o">.</span><span class="n">setParams</span><span class="p">(</span><span class="n">angle_type</span><span class="o">=</span><span class="s1">&#39;a-a-a&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">=</span><span class="p">[</span><span class="mf">400.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">])</span><span class="c1">#param=[k, t0]</span>
<span class="n">app</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fa</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="forcefield-bonded-bond.html" class="btn btn-neutral float-left" title="Bond interactions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="forcefield-bonded-dihedral.html" class="btn btn-neutral float-right" title="Dihedral torsion" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, You-Liang Zhu and Zhong-Yuan Lu, ylzhu@pygamd.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>